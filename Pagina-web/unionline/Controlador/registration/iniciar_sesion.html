{% load static %}
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
    
    <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,600;1,700&family=Amatic+SC:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Inter:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link rel="stylesheet" href="{% static 'css/reset.css' %}">
  <link rel="stylesheet" href="{% static 'css/login.css' %}">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js" ></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/3.3.4/inputmask/inputmask.js" ></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/3.3.4/jquery.inputmask.bundle.js" ></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/3.3.4/css/inputmask.min.css" rel="stylesheet"/>
  <!-- CSS only -->
  <script src="https://kit.fontawesome.com/33be0875fa.js" crossorigin="anonymous"></script>
</head>
 
<body>
  <header>
    <div class="arriba">
      <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
          <a href="{% url 'inicio' %}" class="navbar-brand">
            CBRS de Chile.
          </a>
        </div>
      </nav>
    </div>
  </header>
    <main>

        <form class="formulario" action="" id="formulario-login" enctype="multipart/formdata" method="POST">
          {% csrf_token %}
            <h1>Iniciar Sesión</h1>
            <div class="contenedor">
                <div class="input-contenedor">
                    <i class="fa-solid fa-user icon"></i>
                    <input type="text" onkeyup="mascara(this,formatoRUT)" name="rut" id="rut" placeholder="Rut" maxlength="12">
                </div>

                <div class="input-contenedor">
                    <i class="fa-solid fa-lock icon"></i>
                    <input type="password" name="password" id="contraseña" placeholder="Contraseña">
                </div>

                <div>
                    <input type="submit" value="Iniciar Sesión" class="button">
                </div>
                
                <div>
                  <a href="{% url 'password_reset' %}" class="btn">Olvidé mi contraseña</a>
                </div>

        </form>
        <div class="mensaje">
          {% if messages %}
            <ul class="messages">
              {% for message in messages %}
                <div class="container-fluid p-0">
                  <div class="alert {{ message.tags }} alert-dismissible" role="alert" >
                    {{ message }}
                  </div>
                </div>
              {% endfor %}
            </ul>
          {% endif %}
        </div>
    </main>
    <footer>
      <p class="copyright">&copy Copyright Ministerio de Vivienda y Urbanismo - 2022</p>
    </footer>

</body>
<script>
  // oír los cambios en la caja de texto e ir dando formato al RUT
document.addEventListener('input', (e) => {
const rut = document.getElementById('rut');

if (e.target === rut) {
let rutFormateado = darFormatoRUT(rut.value);
rut.value = rutFormateado;
}
});

// dar formato XX.XXX.XXX-X
function darFormatoRUT(rut) {
// dejar solo números y letras 'k'
const rutLimpio = rut.replace(/[^0-9kK]/g, '');

// asilar el cuerpo del dígito verificador
const cuerpo = rutLimpio.slice(0, -1);
const dv = rutLimpio.slice(-1).toUpperCase();

if (rutLimpio.length < 2) return rutLimpio;

// colocar los separadores de miles al cuerpo
let cuerpoFormatoMiles = cuerpo
.toString()
.split('')
.reverse()
.join('')
.replace(/(?=\d*\.?)(\d{3})/g, '$1.');

cuerpoFormatoMiles = cuerpoFormatoMiles
.split('')
.reverse()
.join('')
.replace(/^[\.]/, '');

return `${cuerpoFormatoMiles}-${dv}`;
}
</script>
</html>